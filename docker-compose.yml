# Docker Compose for 386BSD Development
# Provides a complete development environment for local development

version: '3.8'

services:
  dev:
    build:
      context: .
      dockerfile: .github/containers/Dockerfile.dev
    container_name: 386bsd-dev
    volumes:
      - .:/workspace
      - build-cache:/workspace/build
      - bmake-cache:/tmp/bmake-cache
    working_dir: /workspace
    environment:
      - CC=gcc
      - CXX=g++
      - MAKEFLAGS=-j$(nproc)
    command: tail -f /dev/null  # Keep container running
    
  docs:
    build:
      context: .
      dockerfile: .github/containers/Dockerfile.dev
    container_name: 386bsd-docs
    volumes:
      - .:/workspace
      - docs-build:/workspace/build/docs
    working_dir: /workspace
    ports:
      - "8080:8080"
    command: >
      bash -c "
        mkdir -p build && cd build && 
        cmake .. -DBUILD_DOCS=ON -DBUILD_TESTS=OFF && 
        make docs && 
        cd docs && 
        python3 -m http.server 8080 --bind 0.0.0.0
      "

volumes:
  build-cache:
  bmake-cache:
  docs-build: